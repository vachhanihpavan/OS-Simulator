

<html>
<head>

<style>

h1
{
 background-color:grey;                     /* Tree structure directory */
 color:black;
 margin:-8;
 padding:5;
 font-family:Arial;
 position:fixed;
 display:block;
 width:100%;
 text-align:center; 
}

div
{
    display:inline-block;
    background-color: black;
    color:green;
    width: 1250px;
    height: 400px;
    border: 3px solid grey;
    position:relative;
    top:150px;
    left:50px;
    overflow: auto;
}

.textbox 
{ 
    background: black; 
    height:25px; 
    width: 275px; 
    border: none; 
    color: green; 
    outline: none; 
} 
 
</style>
</head>

<body>

<h1>File Management</h1>

<div id = 'div'></div>

<script>

var clipboard = []                // To store files to clipboard to copy or move them 
var pre = "root@"            // Beginning of each terminal line
var current_path = ""            // Current location of user     
var pointer = -1                   // pointer points to the index of the current directory
                                   //pointer = -1 corresponds to root directory
var file_dir = []                 // List of files and directories
var commands = ["create","mkdir","rmdir","vi","rm","cd","truncate","ls","setaccess","rename","properties","creategroup","signout"]
var passwords = ['abc','def','ghi','jkl']           // Passwords of all users
/*
create : For creating a file
mkdir : Creating a directory
rmdir : Deleting a directory
vi : Open a file
rm : Delete a file
cd : Go to a directory
truncate : Delete contents of a file
ls : List contents of a directory
cut : Move a file to clipboard
copy : Copy a file to clipboard
paste : Paste a file from clipboard to directory
setaccess : Change access permissions of file
-----Interface of setaccess------
User : rwx                     User has to enter these permissions in this format in the textbox
group : rw-
other : r--
-----------------------------
rename : Rename a file
properties : Display properties of file
*/
var textbox
var contents
var divide
var lslabel
var index
var ufd                       // Contains the index of the current user file directory 
var userin

userdir('user_1')
userdir('user_2')
userdir('user_3')
userdir('user_4')

 
signup()

function signup()
{
 var div = document.getElementById('div')
 var choice = -1
 var pointer = -1
 var br1 = document.createElement("br")
 var br2 = document.createElement("br")
 var br3 = document.createElement("br")
 var br4 = document.createElement("br")
 var br5 = document.createElement("br")
 var br6 = document.createElement("br")
 var label1 = document.createTextNode('User Signup')
 var label2 = document.createTextNode('1. User 1')
 var label3 = document.createTextNode('2. User 2')
 var label4 = document.createTextNode('3. User 3')
 var label5 = document.createTextNode('4. User 4')
 var label6 = document.createTextNode('Enter user number and password ')
 userin = document.createElement('input')
 userin.setAttribute("class","textbox")
 userin.setAttribute("type","text")
 userin.setAttribute("onkeydown","signupresponse(event,userin.value)") 
 div.appendChild(label1)
 div.appendChild(br1)
 div.appendChild(label2)
 div.appendChild(br2)
 div.appendChild(label3)
 div.appendChild(br3)
 div.appendChild(label4)
 div.appendChild(br4)
 div.appendChild(label5)
 div.appendChild(br5)
 div.appendChild(label6)
 div.appendChild(userin)
 div.appendChild(br6)
} 

function signupresponse(event,userinput)
{
 var x = event.keyCode
 if(x == 13)
 {
	 var userin_split = userinput.split(" ")
	 alert(userin_split[0])
	 alert(userin_split[1])
	 switch(userin_split[0])
	 {
	  case '1':if(userin_split[1] == passwords[0])  
	  	 {
	  	  current_path = 'user_1/'
	  	  ufd = 0
	  	  pointer = 0
	  	  start()
	  	 }	
	  	 break
	  case '2':if(userin_split[1] == passwords[1])  
	  	 {
	  	  current_path = 'user_2/'
	  	  ufd = 1
	  	  pointer = 1
	  	  start()
	  	 }	
	  	 break 
	  case '3':if(userin_split[1] == passwords[2])  
	  	 {
	  	  current_path = 'user_3/'
	  	  ufd = 2
	  	  pointer = 2
	  	  start()
	  	 }	
	  	 break 
	  case '4':if(userin_split[1] == passwords[3])  
	  	 {
	  	  current_path = 'user_4/'
	  	  ufd = 3
	  	  pointer = 3
	  	  start()
	  	 }	
	  	 break
	  default:signup()
	 }
 }
}

function signout()
{
 signup()
}  
 
 
function start()
{
 var div = document.getElementById('div')
 var label = document.createTextNode(pre + current_path)
 var br = document.createElement("br")
 textbox = document.createElement('input')
 textbox.setAttribute("class","textbox")
 textbox.setAttribute("type","text")
 textbox.setAttribute("onkeydown","nextline(event,textbox.value)")
 div.appendChild(label)
 div.appendChild(textbox)
 div.appendChild(br)
}


function nextline(event,text)
{
 var x = event.keyCode;
 if(x == 13)
 {
  divide = text.split(" ")
  user_com = divide[0]
  for(i=0;i<commands.length;i++)
  {
   if(user_com == commands[i])
   {
    alert(i) 
    break
   }
  }
  if(i < commands.length)
  {
   switch(i)
   {
    case 0:create(divide[1])
	   break    
    case 1:mkdir(divide[1])
           break 
    case 2:rmdir(divide[1])
    	   break
    case 3:vi(divide[1])
    	   break	
    case 4:rm(divide[1])
    	   break
    case 5:cd(divide[1])
    	   break       	
    case 6:truncate(divide[1])
    	   break 
    case 7:ls()
    	   break 
    case 8:setaccess(divide[1])
    	    break 
    case 9:rename(divide[1])
    	    break
    case 10:properties(divide[1])
	    break
    case 11:creategroup(divide[1])
            break	    
    case 12:signout(divide[1])
            break 
   }
  }
 }
}

/*
Form in which entries are entered in file_dir :
Each entry is a list
1. Name of file : string
2. File/directory : Binary value - 0 for file, 1 for directory
3. Address of previous directory : Index of previous directory
4. Size : Length of content of file
5. Protection : User, Group, Other
6. Location : Location of file
7. Content : String 
*/

function create(file)          // Working
{
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == file && file_dir[i][2] == pointer)           // Second condition verifies whether elements of current directory are checked 
  {								    // or not	
   alert("File already exists")
   start()
   return
  }
 }
 file_dir.push([file,0,pointer,0,666,current_path,""])
 start()
}

function mkdir(dir)          // Working 
{
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == dir && file_dir[i][2] == pointer)           // Second condition verifies whether elements of current directory are checked 
  {								    // or not	
   alert("Directory already exists")
   start()
   return
  }
 }
 file_dir.push([dir,1,pointer,0,666,current_path,""])
 start()
}

function userdir(dir)          // Working 
{
 file_dir.push([dir,1,pointer,0,666,current_path,""])
}

function ls()                // Working
{
 var div = document.getElementById('div')
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][2] == pointer)
  {
   var label = document.createTextNode(String(file_dir[i][0]) + " ")
   div.appendChild(label)
  }
 } 
 var br = document.createElement("br")
 div.appendChild(br) 
 start()
}

function rmdir(dir)           // Working
{
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == dir && file_dir[i][2] == pointer && file_dir[i][1] == 1)           
  {								    			 	
   file_dir.splice(i,1)
   start()
   return
  }
 }
 div = document.getElementById('div')
 var label = document.createTextNode("Directory not found")
 var br = document.createElement("br")
 div.appendChild(label)
 div.appendChild(br)
 start()
}

function rm(file)            // Working    
{
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == file && file_dir[i][2] == pointer && file_dir[i][1] == 0)           
  {								    			 
   file_dir.splice(i,1)
   start()
   return
  }
 }
 div = document.getElementById('div')
 var label = document.createTextNode("File not found")
 var br = document.createElement("br")
 div.appendChild(label)
 div.appendChild(br)
 start()
}

function vi(file)                                       // Working
{
 div = document.getElementById('div')
 var flag = 0
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == file && file_dir[i][2] == pointer && file_dir[i][1] == 0)           
  {		
   flag = 1                                              // File is found
   var br = document.createElement("br")
   var br1 = document.createElement("br")
   var prompt = document.createTextNode("Press Ctrl to Save and Exit")					    			 	
   contents = document.createElement('input')
   contents.setAttribute("class","textbox")
   contents.setAttribute("type","text")
   index = i
   contents.setAttribute("onkeydown","savefile(event,contents.value,index)")
   contents.value = file_dir[i][6]                      // Contents of file are copied to the textbox
   div.appendChild(prompt)
   div.appendChild(br)
   div.appendChild(contents)
   div.appendChild(br1)   
  }
 }
 if(flag == 0)
 {
  var label = document.createTextNode("File not found")
  var br = document.createElement("br")
  div.appendChild(label)
  div.appendChild(br)
  start()
 }
}

function savefile(event,text,index)                   // Save contents of file    // Working
{
 var x = event.keyCode
 if(x == 17)
 {
  file_dir[index][6] = text
  alert("File saved")
  start()
 }
} 

function cd(dir)                                     // Working
{
 if(dir == '..')
 {
  pointer = ufd
  current_path = file_dir[ufd][0] + '/'             // Coming back to the user file directory
  return
 }
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == dir && file_dir[i][2] == pointer && file_dir[i][1] == 1)           
  {								    			 	
   pointer = i                                        // Change current directory - Change position of pointer
   current_path = current_path + dir + '/'
   start()
   return
  }
 }
 div = document.getElementById('div')
 var label = document.createTextNode("Directory not found")
 var br = document.createElement("br")
 div.appendChild(label)
 div.appendChild(br)
 start()
}

function truncate(file)
{
 for(i=0;i<file_dir.length;i++)
 {
  if(file_dir[i][0] == file && file_dir[i][2] == pointer && file_dir[i][1] == 0)           
  {								    			 
   file_dir[i][6] = ""
   start()
   return
  }
 }
 div = document.getElementById('div')
 var label = document.createTextNode("File not found")
 var br = document.createElement("br")
 div.appendChild(label)
 div.appendChild(br)
 start()
}



  
</script>
</body>
</html>
